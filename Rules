#!/usr/bin/env ruby

preprocess do
    tags.each do |tag|
        content = '<%= with_tag("'+tag+'").enum %>'
        title = "Posts with tag '#{tag}'"
        identifier = "/tag/#{tag}/"
        @items << Nanoc::Item.new(content, {:title  => title}, identifier)
    end
end

compile '/assets/style/' do
    filter :sass, syntax: :scss
end

compile '*' do
    unless item.binary?
        filter :erb
        filter :kramdown
        layout 'default'
    end
end

route '/assets/style/' do
    item.identifier.chop + '.css'
end

route '/blog/*/' do
    item.identifier[5..-1] + 'index.html'
end

route '*' do
    if item.binary?
        item.identifier.chop + '.' + item[:extension]
    elsif item[:published]
        "/"+item[:published].to_s.gsub("-","/")+item.identifier + 'index.html'
    else
        item.identifier + 'index.html'
    end
end

layout '*', :erb
