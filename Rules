#!/usr/bin/env ruby

preprocess do
    @items.each do |item|
        if item[:published]
            item[:published] = DateTime.parse(item[:published].to_s)
        end
        if item[:updated]
            item[:updated] = DateTime.parse(item[:updated].to_s)
        end
    end
end

compile '/assets/style/' do
    filter :sass, syntax: :scss
end

compile '/feed/' do
    filter :erb
end

compile '/googlec25b04cecd642132/' do
end

compile '*/view/' do
end

compile '*/thumbnail/' do
    unless item[:extension] == "svg"
        filter :thumbnailize, :width => 300
    end
end

compile '*' do
    unless item.binary?
        filter :erb
        filter :absolutize_paths
        filter :kramdown
        layout 'default'
        if item[:title]
            filter :tidy
        end
    end
end

route '/assets/style/' do
    item.identifier.chop + '.css'
end

route '/googlec25b04cecd642132/' do
    item.identifier.chop + '.html'
end

route '*' do
    if item.binary?
        item.identifier.chop + '.' + item[:extension]
    else
        item.identifier + 'index.html'
    end
end

layout '*', :erb
